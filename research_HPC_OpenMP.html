<!DOCTYPE html>
<head>
    <meta charset="UTF-8" />
    <meta name="google-site-verification" content="rjPzO6U1Itlhx05BZ1b_8nCvoOzXsWobDUC5jwCQTaY" />
    <meta name="description" content="Research on OpenMP." />
    <meta name="keywords" content="lattice Boltzmann method,Ao Xu,Xu Ao,HKUST">

    <title>Ao Xu (HKUST) | Research_OpenMP</title>
    
    <link rel="icon" type="image/vnd.microsoft.icon" href="./favicon.ico" sizes="57x57" />
    
    <link rel="author" type="text/html" href="http://www.linkedin.com/pub/ao-xu/30/a72/a29" />
    <link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/3.0/" />
    
    <link rel="stylesheet" type="text/css" href="./~css/main.css" media="all" />
       <!-- Pygments -->
    <link rel="stylesheet" type="text/css" href="./~css/pygments.css" media="all" />
    
    <!-- load Google Web Fonts -->
    <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Droid+Sans' />

    <!-- <script type="text/javascript" src="./~js/main.js"></script> -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107941848-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107941848-1');
</script>


</head>

<body>
    
    <nav id="navBarTop"> <!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- -->
        <ul class="navBarListLeft">
	 		 <li><a href="./index.html"><img src="./~images/home.png" alt="home" title="Home" class="navDock" height="32"></a></li>
			<li style="position: relative; top: -12px; font-size: 16px"><a href="./research.html">Research</a></li>
	 		<li style="position: relative; top: -12px; font-size: 16px"><a href="./teaching.html">Teaching</a></li>
              <li style="position: relative; top: -12px; font-size: 16px"><a href="./publications.html">Publications</a></li>
			<!--<li style="position: relative; top: -12px; font-size: 16px"><a href="./gallery.html">Gallery</a></li>-->
			<li style="position: relative; top: -12px; font-size: 16px"><a href="./about.html">About</a></li>
        </ul>
        
        <ul class="navBarListRight">
            <li style="position: relative; top: -12px"><b>Ao</b> on </li>
            <li><a href="https://scholar.google.com/citations?user=HO_Bf4IAAAAJ&hl=en" target="_blank"><img src="./~images/googleScholar.png" alt="google scholar" title="Google Scholar" class="navDock" height="32"></a></li>
            <li><a href="http://www.linkedin.com/pub/ao-xu/30/a72/a29" target="_blank"><img src="./~images/linkedin.png" alt="Linked In" title="Linked In" class="navDock" height="32"></a></li>
            <li><a href="https://github.com/xuaoxiqi" target="_blank"><img src="./~images/github.png" alt="github" title="GitHub" class="navDock" height="32"></a></li>
        </ul>
    </nav>
    
    <nav id="navBarBottom"> <!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- --><!-- -->
        <div class="navBarListLeft">            
                <div style="position: relative; top: 4px; width: 150%">    
                    Â©2013-2018  Ao Xu <strong> -- Discussion on multiscale transport phenomena is welcomed. </strong>
                </div>
        </div>
        
        <div class="navBarListRight">
            <div style="position: relative; top: 4px; right: 0">
                Last updated: <b>Aug. 2018</b>
            </div>
        </div>
    </nav>
    
        <div id="divTitleNav">
        <a href="./research.html"><img src="./~images/left-arrow.png" class="navDock" /></a>
    </div>
    
<div id="divPost">

    <article id="articlePost">
    <br/>
 
    <h2>Open Multi-Processing (OpenMP)</h2>
            <hr/>

    <p>
Open Multi-Processing (OpenMP) is an application programming interface (API) that supports shared memory multiprocessing programming.
It fits shared-memory parallel computers (SMPs).
    </p>
    
    <h3>Sample OpenMP code</h3>
    
    <h4>Calculate Pi</h4>
    <embed src="./~codes/calPi_OpenMP.F90" width="88%">
    
    <h4>Compile</h4>
Below is examples of adding compiler flag to various compilers in OpenMP code:
			<pre> <code>
$ <font color="red">ifort -qopenmp</font> -O2 calPi_OpenMP.F90 -o calPi
$ <font color="red">pgf90 -mp</font> calPi_OpenMP.F90 -o calPi
$ <font color="red">gfortran -fopenmp</font> -O2 -fcheck=all calPi_OpenMP.F90 -o calPi

On Tianhe-2, job.sh file:
#!/bin/bash
module load intelcompiler/18.0.0
yhrun -N 1 -n 1 -c 24 -p bigdata ./calPi
Running:
yhbatch -N 1 -p bigdata ./job.sh
			</code> </pre>
            
To set the number of running treads, one may set the enviroment variables as
			<pre> <code>
export OMP_NUM_THREADS=4 && ./calPi
			</code> </pre>

or use conditional compilation as
			<pre> <code>
#ifdef _OPENMP
    call OMP_set_num_threads(2)
    myMaxThreads = OMP_get_max_threads()
    write(*,*) "Max Running threads=",myMaxThreads
#endif
			</code> </pre>
            
The preprocessing is activated with a compile-time flag, i.e., <b>-cpp</b> for gfortran, <b>-fpp</b> for ifort. 
Another trick is simply change the file name from <b>*.f90</b> to <b>*.F90</b>.
    
    <h3>OpenMP in lattice Boltzmann method</h3>
    <P>
Standard lattice Boltzmann method (LBM) mainly contains three parts: collision, streaming, and calculating macroscopic variables.
The first and the last parts are quite easy to parallelize, due to the space locality of the numerical algorithm.
As a matter of fact, a  <i>PARALLEL DO</i> construct is enough. 
In streaming step, the distribution function exchange the information with its neighboring node.
    </p>
            
    <h4>Example: Lid driven cavity flow</h4>
    <p>
In 2D test, the mesh size 1024*1024, and the iterative time is 10000;
In 3D test, the mesh size 128*128*128, and the iterative time is 10000.
Each case is repeated 3 times to reduce the random error.
    </p>
    <p>
The operating system is Linux, and the compiler is ifort.
    </p>
    <img src="./~images/research/HPC/OpenMP/OpenMP-2D.png" width="49%"></img>
    <img src="./~images/research/HPC/OpenMP/OpenMP-3D.png" width="49%"></img>
    
    <h4>Speedup and Efficiency</h4>
    
    <img src="./~images/research/HPC/OpenMP/speedupEfficiency.png" width="49%"></img>
    

    <p>
The code scales to 16 threads while maintaining parallel efficiency above 50%.
However, further increasing the number of threads lead to subtitle performance optimization (or may even degrade the speedup due to the overhead).
    </p>
    
    <h3>High performance computing techniques (Read more...)</h3>
        <ul class="ulResearch">
            <li class="liResearch"><a href="./research_HPC_OpenMP.html">Open Multi-Processing (OpenMP)</a></li>
            <li class="liResearch"><a href="./research_HPC_MPI.html">Message Passing Interface (MPI)</a></li>
            <li class="liResearch"><a href="./research_HPC_OpenACC.html">Open Accelerators (OpenACC)</a></li>
        </ul>
        
    </article>
    
    <div class="div0"></div>
    
</div>

    
  
</body>
</html>
